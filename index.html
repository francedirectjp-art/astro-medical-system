
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>占星医学体質鑑定システム - 完全版</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Hiragino Sans', 'Yu Gothic', 'Meiryo', sans-serif;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .step-indicator {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 2rem 0;
            gap: 1rem;
        }
        
        .step {
            width: 3rem;
            height: 3rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            transition: all 0.3s ease;
        }
        
        .step.active {
            background: linear-gradient(135deg, #ffd700, #ffb347);
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
            transform: scale(1.1);
        }
        
        .step.completed {
            background: linear-gradient(135deg, #4CAF50, #45a049);
        }
        
        .step.inactive {
            background: #ddd;
            color: #999;
        }
        
        .step-line {
            width: 4rem;
            height: 2px;
            background: #ddd;
            transition: all 0.3s ease;
        }
        
        .step-line.completed {
            background: linear-gradient(135deg, #4CAF50, #45a049);
        }
        
        .planet-card {
            background: linear-gradient(135deg, #f8f9ff, #e8f0ff);
            transition: all 0.3s ease;
        }
        
        .planet-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.1);
        }
        
        .element-fire { background: linear-gradient(135deg, #ff6b6b, #ee5a24); }
        .element-earth { background: linear-gradient(135deg, #26de81, #20bf6b); }
        .element-air { background: linear-gradient(135deg, #74b9ff, #0984e3); }
        .element-water { background: linear-gradient(135deg, #a29bfe, #6c5ce7); }
        
        .loading-spinner {
            width: 3rem;
            height: 3rem;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .fade-in {
            animation: fadeIn 0.8s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .connection-status {
            position: fixed;
            top: 1rem;
            right: 1rem;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            color: white;
            font-size: 0.875rem;
            z-index: 1000;
        }
        
        .connection-success {
            background: #4CAF50;
        }
        
        .connection-error {
            background: #f44336;
        }
        
        .detailed-report {
            max-height: 600px;
            overflow-y: auto;
            border: 1px solid #e2e8f0;
        }
    </style>
</head>
<body class="p-4">
    <!-- 接続ステータス表示 -->
    <div id="connectionStatus" class="connection-status connection-error" style="display: none;">
        <i class="fas fa-circle mr-2"></i>
        <span id="statusText">接続確認中...</span>
    </div>

    <div class="max-w-4xl mx-auto">
        <!-- ヘッダー -->
        <div class="glass-card rounded-t-3xl p-8 text-center text-white" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
            <h1 class="text-4xl font-light mb-4">
                <i class="fas fa-star mr-3"></i>
                占星医学体質鑑定システム
                <i class="fas fa-star ml-3"></i>
            </h1>
            <p class="text-xl opacity-90">あなたの出生時の天体配置から体質を診断します</p>
            <p class="text-sm mt-2 opacity-75">12,000文字詳細鑑定書対応版</p>
        </div>

        <!-- ステップインジケーター -->
        <div class="glass-card p-6">
            <div class="step-indicator">
                <div class="step active" id="step1">1</div>
                <div class="step-line" id="line1"></div>
                <div class="step inactive" id="step2">2</div>
                <div class="step-line" id="line2"></div>
                <div class="step inactive" id="step3">3</div>
                <div class="step-line" id="line3"></div>
                <div class="step inactive" id="step4">4</div>
            </div>
        </div>

        <!-- メインコンテンツ -->
        <div class="glass-card rounded-b-3xl p-8">
            
            <!-- ステップ1: 基本情報入力 -->
            <div id="section1" class="fade-in">
                <h2 class="text-2xl font-bold mb-6 text-gray-800">
                    <i class="fas fa-user mr-2 text-blue-600"></i>
                    基本情報をご入力ください
                </h2>
                
                <div class="grid gap-6">
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">お名前</label>
                        <input type="text" id="name" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none transition-colors" placeholder="例：山田太郎">
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">生年月日</label>
                        <div class="grid grid-cols-3 gap-3">
                            <select id="birthYear" class="px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none">
                                <option value="">年</option>
                            </select>
                            <select id="birthMonth" class="px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none">
                                <option value="">月</option>
                            </select>
                            <select id="birthDay" class="px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none">
                                <option value="">日</option>
                            </select>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">出生時間</label>
                        <div class="grid grid-cols-2 gap-3">
                            <select id="birthHour" class="px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none">
                                <option value="">時</option>
                            </select>
                            <select id="birthMinute" class="px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none">
                                <option value="">分</option>
                            </select>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">出生地（都道府県）</label>
                        <select id="birthPrefecture" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none">
                            <option value="">都道府県を選択</option>
                            <option value="北海道">北海道</option>
                            <option value="青森県">青森県</option>
                            <option value="岩手県">岩手県</option>
                            <option value="宮城県">宮城県</option>
                            <option value="秋田県">秋田県</option>
                            <option value="山形県">山形県</option>
                            <option value="福島県">福島県</option>
                            <option value="茨城県">茨城県</option>
                            <option value="栃木県">栃木県</option>
                            <option value="群馬県">群馬県</option>
                            <option value="埼玉県">埼玉県</option>
                            <option value="千葉県">千葉県</option>
                            <option value="東京都">東京都</option>
                            <option value="神奈川県">神奈川県</option>
                            <option value="新潟県">新潟県</option>
                            <option value="富山県">富山県</option>
                            <option value="石川県">石川県</option>
                            <option value="福井県">福井県</option>
                            <option value="山梨県">山梨県</option>
                            <option value="長野県">長野県</option>
                            <option value="岐阜県">岐阜県</option>
                            <option value="静岡県">静岡県</option>
                            <option value="愛知県">愛知県</option>
                            <option value="三重県">三重県</option>
                            <option value="滋賀県">滋賀県</option>
                            <option value="京都府">京都府</option>
                            <option value="大阪府">大阪府</option>
                            <option value="兵庫県">兵庫県</option>
                            <option value="奈良県">奈良県</option>
                            <option value="和歌山県">和歌山県</option>
                            <option value="鳥取県">鳥取県</option>
                            <option value="島根県">島根県</option>
                            <option value="岡山県">岡山県</option>
                            <option value="広島県">広島県</option>
                            <option value="山口県">山口県</option>
                            <option value="徳島県">徳島県</option>
                            <option value="香川県">香川県</option>
                            <option value="愛媛県">愛媛県</option>
                            <option value="高知県">高知県</option>
                            <option value="福岡県">福岡県</option>
                            <option value="佐賀県">佐賀県</option>
                            <option value="長崎県">長崎県</option>
                            <option value="熊本県">熊本県</option>
                            <option value="大分県">大分県</option>
                            <option value="宮崎県">宮崎県</option>
                            <option value="鹿児島県">鹿児島県</option>
                            <option value="沖縄県">沖縄県</option>
                        </select>
                    </div>

                    <button onclick="calculatePlanets()" class="w-full bg-gradient-to-r from-yellow-400 to-orange-400 text-white font-bold py-4 px-6 rounded-lg hover:from-yellow-500 hover:to-orange-500 transition-all duration-300 transform hover:scale-105 shadow-lg">
                        <i class="fas fa-star mr-2"></i>
                        天体位置を計算する
                    </button>
                </div>
            </div>

            <!-- ステップ2: 天体位置表示 -->
            <div id="section2" class="hidden fade-in">
                <h2 class="text-2xl font-bold mb-6 text-gray-800">
                    <i class="fas fa-globe mr-2 text-purple-600"></i>
                    あなたの天体配置
                </h2>
                <div id="planetsGrid" class="grid gap-4 md:grid-cols-2 lg:grid-cols-3 mb-6"></div>
                <button id="diagnosisBtn" onclick="performDiagnosis()" class="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold py-4 px-6 rounded-lg hover:from-purple-600 hover:to-pink-600 transition-all duration-300 transform hover:scale-105 shadow-lg" style="display: none;">
                    <i class="fas fa-magic mr-2"></i>
                    体質診断をする
                </button>
            </div>

            <!-- ステップ3: 簡易診断結果 -->
            <div id="section3" class="hidden fade-in">
                <h2 class="text-2xl font-bold mb-6 text-gray-800">
                    <i class="fas fa-heart mr-2 text-red-500"></i>
                    <span id="userName"></span>さんの体質診断
                </h2>
                <div id="diagnosisResult"></div>
                <button id="detailedReportBtn" onclick="generateDetailedReport()" class="w-full bg-gradient-to-r from-green-500 to-blue-500 text-white font-bold py-4 px-6 rounded-lg hover:from-green-600 hover:to-blue-600 transition-all duration-300 transform hover:scale-105 shadow-lg mt-6" style="display: none;">
                    <i class="fas fa-scroll mr-2"></i>
                    12,000文字詳細鑑定書を生成する
                </button>
            </div>

            <!-- ステップ4: 詳細鑑定書 -->
            <div id="section4" class="hidden fade-in">
                <h2 class="text-2xl font-bold mb-6 text-gray-800">
                    <i class="fas fa-book-open mr-2 text-indigo-600"></i>
                    詳細鑑定書（12,000文字）
                </h2>
                <div id="detailedReportResult" class="detailed-report bg-gray-50 p-6 rounded-lg"></div>
                <div id="reportStats" class="mt-4 text-center text-gray-600"></div>
            </div>

            <!-- ローディング -->
            <div id="loading" class="hidden text-center py-12">
                <div class="loading-spinner"></div>
                <p class="mt-4 text-gray-600">処理中です...しばらくお待ちください ⭐</p>
            </div>

            <!-- エラー表示 -->
            <div id="error" class="hidden bg-red-50 border-l-4 border-red-500 p-4 mb-4 rounded">
                <div class="flex">
                    <i class="fas fa-exclamation-circle text-red-500 mr-3 mt-1"></i>
                    <div>
                        <h3 class="text-red-800 font-bold">エラーが発生しました</h3>
                        <p id="errorMessage" class="text-red-700 mt-1"></p>
                    </div>
                </div>
            </div>

        </div>

        <!-- フッター -->
        <div class="text-center mt-6 text-white text-sm opacity-75">
            <p><i class="fas fa-info-circle mr-1"></i> 本結果はエンターテインメント目的です。医療診断ではありません。</p>
            <p class="mt-2">Powered by Swiss Ephemeris & Google Gemini AI</p>
        </div>
    </div>

    <script>
        // API設定
        const API_BASE_URL = 'http://localhost:8107';
        const BETA_KEY = 'astro2024beta';

        // グローバル変数
        let currentStep = 1;
        let planetsData = null;

        // 初期化
        document.addEventListener('DOMContentLoaded', function() {
            initializeSelects();
            checkApiConnection();
        });

        // API接続確認
        async function checkApiConnection() {
            const statusElement = document.getElementById('connectionStatus');
            const statusText = document.getElementById('statusText');
            
            statusElement.style.display = 'block';
            statusText.textContent = '接続確認中...';

            try {
                const response = await fetch(`${API_BASE_URL}/health`);
                if (response.ok) {
                    statusElement.className = 'connection-status connection-success';
                    statusText.innerHTML = '<i class="fas fa-check-circle mr-2"></i>APIサーバー接続OK';
                    setTimeout(() => {
                        statusElement.style.display = 'none';
                    }, 3000);
                } else {
                    throw new Error('Server responded with error');
                }
            } catch (error) {
                statusElement.className = 'connection-status connection-error';
                statusText.innerHTML = '<i class="fas fa-times-circle mr-2"></i>APIサーバー接続エラー';
                showError('APIサーバーに接続できません。サーバーが起動しているか確認してください。');
            }
        }

        // セレクトボックスの初期化
        function initializeSelects() {
            // 年の選択肢（1900-2030）
            const yearSelect = document.getElementById('birthYear');
            for (let year = 2030; year >= 1900; year--) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year + '年';
                yearSelect.appendChild(option);
            }

            // 月の選択肢
            const monthSelect = document.getElementById('birthMonth');
            for (let month = 1; month <= 12; month++) {
                const option = document.createElement('option');
                option.value = month;
                option.textContent = month + '月';
                monthSelect.appendChild(option);
            }

            // 日の選択肢
            const daySelect = document.getElementById('birthDay');
            for (let day = 1; day <= 31; day++) {
                const option = document.createElement('option');
                option.value = day;
                option.textContent = day + '日';
                daySelect.appendChild(option);
            }

            // 時の選択肢
            const hourSelect = document.getElementById('birthHour');
            for (let hour = 0; hour <= 23; hour++) {
                const option = document.createElement('option');
                option.value = hour;
                option.textContent = hour + '時';
                hourSelect.appendChild(option);
            }

            // 分の選択肢
            const minuteSelect = document.getElementById('birthMinute');
            for (let minute = 0; minute <= 59; minute++) {
                const option = document.createElement('option');
                option.value = minute;
                option.textContent = minute + '分';
                minuteSelect.appendChild(option);
            }
        }

        // ステップ遷移
        function goToStep(step) {
            // 現在のセクションを非表示
            document.getElementById(`section${currentStep}`).classList.add('hidden');
            
            // 新しいセクションを表示
            document.getElementById(`section${step}`).classList.remove('hidden');
            
            // ステップインジケーターを更新
            updateStepIndicator(step);
            
            currentStep = step;
        }

        // ステップインジケーター更新
        function updateStepIndicator(activeStep) {
            for (let i = 1; i <= 4; i++) {
                const stepElement = document.getElementById(`step${i}`);
                const lineElement = document.getElementById(`line${i}`);
                
                if (i < activeStep) {
                    stepElement.className = 'step completed';
                    if (lineElement) lineElement.className = 'step-line completed';
                } else if (i === activeStep) {
                    stepElement.className = 'step active';
                } else {
                    stepElement.className = 'step inactive';
                    if (lineElement) lineElement.className = 'step-line';
                }
            }
        }

        // 天体位置計算
        async function calculatePlanets() {
            const name = document.getElementById('name').value;
            const year = parseInt(document.getElementById('birthYear').value);
            const month = parseInt(document.getElementById('birthMonth').value);
            const day = parseInt(document.getElementById('birthDay').value);
            const hour = parseInt(document.getElementById('birthHour').value);
            const minute = parseInt(document.getElementById('birthMinute').value);
            const prefecture = document.getElementById('birthPrefecture').value;

            // バリデーション
            if (!name || !year || !month || !day || hour === '' || minute === '' || !prefecture) {
                showError('すべての項目を入力してください。');
                return;
            }

            showLoading(true);
            hideError();

            try {
                const response = await fetch(`${API_BASE_URL}/api/calculate-planets`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        name: name,
                        birth_year: year,
                        birth_month: month,
                        birth_day: day,
                        birth_hour: hour,
                        birth_minute: minute,
                        birth_prefecture: prefecture
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                
                if (data.success) {
                    planetsData = data.planets;
                    displayPlanets(data.planets);
                    goToStep(2);
                } else {
                    throw new Error(data.error || '計算エラーが発生しました。');
                }

            } catch (error) {
                console.error('Error:', error);
                showError('計算中にエラーが発生しました: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        // 天体位置表示
        function displayPlanets(planets) {
            const planetsGrid = document.getElementById('planetsGrid');
            planetsGrid.innerHTML = '';

            const planetNames = {
                'sun': '太陽 ☉',
                'moon': '月 ☽',
                'mercury': '水星 ☿',
                'venus': '金星 ♀',
                'mars': '火星 ♂',
                'jupiter': '木星 ♃',
                'saturn': '土星 ♄'
            };

            const elementClasses = {
                '火': 'element-fire',
                '地': 'element-earth',
                '風': 'element-air',
                '水': 'element-water'
            };

            Object.entries(planets).forEach(([planetKey, planetData]) => {
                const planetCard = document.createElement('div');
                planetCard.className = 'planet-card p-4 rounded-lg border-2 border-gray-200';
                
                planetCard.innerHTML = `
                    <div class="font-bold text-lg text-purple-600 mb-2">${planetNames[planetKey]}</div>
                    <div class="text-gray-700 mb-1">星座: ${planetData.sign}</div>
                    <div class="text-gray-700 mb-1">度数: ${planetData.degree}°</div>
                    <div class="text-gray-700 mb-3">経度: ${planetData.longitude}°</div>
                    <div class="inline-block px-3 py-1 rounded-full text-white text-sm font-semibold ${elementClasses[planetData.element]}">
                        ${planetData.element}エレメント
                    </div>
                `;
                
                planetsGrid.appendChild(planetCard);
            });

            document.getElementById('diagnosisBtn').style.display = 'block';
        }

        // 簡易診断実行
        async function performDiagnosis() {
            if (!planetsData) {
                showError('天体位置データがありません。');
                return;
            }

            const name = document.getElementById('name').value;
            
            showLoading(true);
            hideError();

            try {
                const response = await fetch(`${API_BASE_URL}/api/simple-diagnosis`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        name: name,
                        planets: planetsData,
                        sun_element: planetsData.sun.element,
                        moon_element: planetsData.moon.element
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                
                if (data.success) {
                    displayDiagnosis(data);
                    document.getElementById('userName').textContent = name;
                    goToStep(3);
                } else {
                    throw new Error(data.error || '診断エラーが発生しました。');
                }

            } catch (error) {
                console.error('Error:', error);
                showError('診断中にエラーが発生しました: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        // 診断結果表示
        function displayDiagnosis(data) {
            const resultDiv = document.getElementById('diagnosisResult');
            
            const elementBars = Object.entries(data.element_balance).map(([element, percentage]) => {
                const elementNames = {
                    'fire': '火',
                    'earth': '地',
                    'air': '風',
                    'water': '水'
                };
                
                const elementClasses = {
                    'fire': 'element-fire',
                    'earth': 'element-earth',
                    'air': 'element-air',
                    'water': 'element-water'
                };
                
                return `
                    <div class="flex items-center mb-3">
                        <div class="w-12 text-sm font-bold">${elementNames[element]}</div>
                        <div class="flex-1 bg-gray-200 rounded-full h-6 mx-3 overflow-hidden">
                            <div class="h-full ${elementClasses[element]} transition-all duration-1000 ease-out" style="width: ${percentage}%"></div>
                        </div>
                        <div class="w-12 text-sm font-bold text-right">${percentage}%</div>
                    </div>
                `;
            }).join('');

            resultDiv.innerHTML = `
                <div class="bg-gradient-to-br from-purple-50 to-blue-50 p-6 rounded-lg border-2 border-purple-200">
                    <h3 class="text-2xl font-bold text-center text-purple-600 mb-6">${data.archetype}</h3>
                    
                    <div class="mb-6">
                        <h4 class="text-lg font-bold text-gray-700 mb-4">
                            <i class="fas fa-balance-scale mr-2 text-blue-500"></i>
                            エレメントバランス
                        </h4>
                        ${elementBars}
                    </div>
                    
                    <div class="prose max-w-none">
                        <h4 class="text-lg font-bold text-gray-700 mb-4">
                            <i class="fas fa-user-md mr-2 text-green-500"></i>
                            体質診断結果
                        </h4>
                        <div class="text-gray-700 leading-relaxed whitespace-pre-line">${data.diagnosis_text}</div>
                    </div>
                </div>
            `;

            document.getElementById('detailedReportBtn').style.display = 'block';
        }

        // 詳細鑑定書生成
        async function generateDetailedReport() {
            try {
                showLoading(true);
                hideError();

                const name = document.getElementById('name').value;
                const year = document.getElementById('birthYear').value;
                const month = document.getElementById('birthMonth').value;
                const day = document.getElementById('birthDay').value;
                const hour = document.getElementById('birthHour').value;
                const minute = document.getElementById('birthMinute').value;
                const prefecture = document.getElementById('birthPrefecture').value;

                const response = await fetch(`${API_BASE_URL}/api/generate-detailed-report`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        name: name,
                        year: parseInt(year),
                        month: parseInt(month),
                        day: parseInt(day),
                        hour: parseInt(hour),
                        minute: parseInt(minute),
                        birth_prefecture: prefecture
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                
                if (data.success) {
                    displayDetailedReport(data);
                    goToStep(4);
                } else {
                    throw new Error(data.error || '詳細鑑定書生成エラーが発生しました。');
                }

            } catch (error) {
                console.error('詳細鑑定書生成エラー:', error);
                showError('詳細鑑定書の生成中にエラーが発生しました: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        // 詳細鑑定書表示
        function displayDetailedReport(data) {
            const resultDiv = document.getElementById('detailedReportResult');
            const statsDiv = document.getElementById('reportStats');
            
            const reportContent = data.detailed_report || '';
            const charCount = data.character_count || reportContent.length;
            const targetAchieved = data.target_achieved || charCount >= 12000;

            resultDiv.innerHTML = `
                <div class="prose max-w-none">
                    <div class="whitespace-pre-line text-gray-800 leading-relaxed">${reportContent}</div>
                </div>
            `;

            statsDiv.innerHTML = `
                <div class="flex justify-center items-center space-x-6 text-sm">
                    <div class="flex items-center">
                        <i class="fas fa-file-alt mr-2 text-blue-500"></i>
                        <span>文字数: <strong>${charCount.toLocaleString()}</strong></span>
                    </div>
                    <div class="flex items-center">
                        <i class="fas ${targetAchieved ? 'fa-check-circle text-green-500' : 'fa-exclamation-triangle text-yellow-500'} mr-2"></i>
                        <span>目標達成: <strong>${targetAchieved ? 'はい' : 'いいえ'}</strong></span>
                    </div>
                    <div class="flex items-center">
                        <i class="fas fa-star mr-2 text-yellow-500"></i>
                        <span>品質: <strong>${charCount >= 12000 ? '最高' : charCount >= 8000 ? '良好' : '標準'}</strong></span>
                    </div>
                </div>
            `;
        }

        // ローディング表示/非表示
        function showLoading(show) {
            const loading = document.getElementById('loading');
            if (show) {
                loading.classList.remove('hidden');
            } else {
                loading.classList.add('hidden');
            }
        }

        // エラー表示
        function showError(message) {
            const error = document.getElementById('error');
            const errorMessage = document.getElementById('errorMessage');
            errorMessage.textContent = message;
            error.classList.remove('hidden');
        }

        // エラー非表示
        function hideError() {
            const error = document.getElementById('error');
            error.classList.add('hidden');
        }
    </script>
<script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"rayId":"978377710fc1abb4","serverTiming":{"name":{"cfExtPri":true,"cfEdge":true,"cfOrigin":true,"cfL4":true,"cfSpeedBrain":true,"cfCacheStatus":true}},"version":"2025.8.0","token":"4edd5f8ec12a48cfa682ab8261b80a79"}' crossorigin="anonymous"></script>
</body>
</html>
    <script id="html_badge_script1">
        window.__genspark_remove_badge_link = "https://www.genspark.ai/api/html_badge/" +
            "remove_badge?token=To%2FBnjzloZ3UfQdcSaYfDtex32Pxj2P%2Bqkg5n0p7C0iWg1OfQBktojWPR88J%2B%2BJg52xOI0YedDvEwHQefz88Lp9i3UALjG07DdUSmzyWrYoHqw1KBBWLGH6TnzsC5go0phiW%2BnENRcji3uLEno%2Fc81AgCUU7RLSWSw8uOVd950NwVU4z4J9RXooBrvjWuxzyvt0%2FoQfwFWpg6HaAUohxZfa1A4mI85BXqnCCIkXqPnuFKLCymxW0MTvkDANw9A%2FZ8s3DFrdJXWrl8EMdUc3AkUNJ97b%2B6p1is0m5S09KuQtoIwTWXpmp4CNGG9%2BXCqL74uahPuJphlxs6EPXcng5nEeYXnwrZGf9k6TgK1iaiz7nqi3BSl%2F%2BL%2F1xLVNIOTnCTlMSDrUPRHjgV2VKRHpL8iWbW7srORPnTaKu2J2rXY2YTF81NXjGMpBDhhNp97mzrEAZetSnzb6TRapH%2FbKwGoeyqd%2FJU%2F3psyrhYvRvGm0xZ3lGAlnsfYPEP1pxb2jY2vMBNRtAo7W9p5fKLTANI2qPZN720TzP6mAWZseI1Nw%3D";
        window.__genspark_locale = "ja-JP";
        window.__genspark_token = "To/BnjzloZ3UfQdcSaYfDtex32Pxj2P+qkg5n0p7C0iWg1OfQBktojWPR88J++Jg52xOI0YedDvEwHQefz88Lp9i3UALjG07DdUSmzyWrYoHqw1KBBWLGH6TnzsC5go0phiW+nENRcji3uLEno/c81AgCUU7RLSWSw8uOVd950NwVU4z4J9RXooBrvjWuxzyvt0/oQfwFWpg6HaAUohxZfa1A4mI85BXqnCCIkXqPnuFKLCymxW0MTvkDANw9A/Z8s3DFrdJXWrl8EMdUc3AkUNJ97b+6p1is0m5S09KuQtoIwTWXpmp4CNGG9+XCqL74uahPuJphlxs6EPXcng5nEeYXnwrZGf9k6TgK1iaiz7nqi3BSl/+L/1xLVNIOTnCTlMSDrUPRHjgV2VKRHpL8iWbW7srORPnTaKu2J2rXY2YTF81NXjGMpBDhhNp97mzrEAZetSnzb6TRapH/bKwGoeyqd/JU/3psyrhYvRvGm0xZ3lGAlnsfYPEP1pxb2jY2vMBNRtAo7W9p5fKLTANI2qPZN720TzP6mAWZseI1Nw=";
    </script>
    
    <script id="html_notice_dialog_script" src="https://www.genspark.ai/notice_dialog.js"></script>
    
